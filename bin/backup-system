#!/bin/sh

bkupdir="/backup/"

[ ${UID:-`id -u`} -ne 0 ] && {
    echo Error: root privelidges required >&2
    exit 1
}

[ ! -d $bkupdir ] && {
    echo Creating directory -- $bkupdir
    mkdir -p $bkupdir || {
        echo Error: problem creating directory -- $bkupdir >&2
        exit 1
    }
}

rsync \
    --archive \
    --update \
    --verbose \
    --checksum \
    --fuzzy \
    --links \
    --hard-links \
    --perms \
    --owner \
    --group \
    --backup \
    --suffix=`date +.%Y%m%d_%H%M.%S` \
    --timeout=0 \
    --itemize-changes \
    --one-file-system \
    --exclude=$bkupdir \
    --exclude="/dev/*" \
    --exclude="/proc/*" \
    --exclude="/sys/*" \
    --exclude="/tmp/*" \
    --exclude="/run/*" \
    --exclude="/mnt/*" \
    --exclude="/media/*" \
    --exclude="/lost+found" \
    -F \
/ $bkupdir
